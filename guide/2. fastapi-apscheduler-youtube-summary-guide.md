# FastAPI + APScheduler ìœ íŠœë¸Œ ìš”ì•½ ìë™í™” ê°€ì´ë“œ

> GCP + Docker ì„œë²„ ì„¤ì •ì´ ì™„ë£Œëœ ìƒíƒœì—ì„œ ì‹œì‘í•˜ëŠ” ê°€ì´ë“œ  
> ê¸°ìˆ ì  ì›ë¦¬ì™€ í•¨ê»˜ ì„¤ëª…í•˜ëŠ” ë‹¨ê³„ë³„ ìƒì„¸ ê°€ì´ë“œ

---

## ëª©ì°¨

1. [ì „ì²´ êµ¬ì¡° ì´í•´í•˜ê¸°](#1-ì „ì²´-êµ¬ì¡°-ì´í•´í•˜ê¸°)
2. [í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°](#2-í”„ë¡œì íŠ¸-íŒŒì¼-êµ¬ì¡°)
3. [API í‚¤ ë°œê¸‰](#3-api-í‚¤-ë°œê¸‰)
4. [íŒŒì¼ ì‘ì„± - ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…](#4-íŒŒì¼-ì‘ì„±---ë‹¨ê³„ë³„-ìƒì„¸-ì„¤ëª…)
   - 4-1. requirements.txt
   - 4-2. .env
   - 4-3. app/main.py
   - 4-4. app/scheduler.py
   - 4-5. app/youtube.py
   - 4-6. app/transcript.py
   - 4-7. app/summarize.py
   - 4-8. app/mailer.py
   - 4-9. Dockerfile
   - 4-10. docker-compose.yml
5. [ë°°í¬ ë° í…ŒìŠ¤íŠ¸](#5-ë°°í¬-ë°-í…ŒìŠ¤íŠ¸)
6. [ìì£¼ ì“°ëŠ” ê´€ë¦¬ ëª…ë ¹ì–´](#6-ìì£¼-ì“°ëŠ”-ê´€ë¦¬-ëª…ë ¹ì–´)
7. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#7-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## 1. ì „ì²´ êµ¬ì¡° ì´í•´í•˜ê¸°

### 1-1. ì „ì²´ íë¦„

```
[APScheduler - ë§¤ì¼ 07:00 KST]
        â†“
[YouTube Data API v3]
â†’ êµ¬ë… ì±„ë„ë³„ë¡œ ì§€ë‚œ 24ì‹œê°„ ë‚´ ì˜¬ë¼ì˜¨ ì˜ìƒ ëª©ë¡ ì¡°íšŒ
        â†“
[Supadata API]
â†’ ê° ì˜ìƒì˜ ìë§‰(ìŠ¤í¬ë¦½íŠ¸) í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        â†“
[Gemini API]
â†’ ìë§‰ì„ ì½ê³  í•µì‹¬ ë‚´ìš© ë¶ˆë¦¿ ìš”ì•½ ìƒì„±
        â†“
[Gmail SMTP]
â†’ ìš”ì•½ ë‚´ìš©ì„ HTML ì´ë©”ì¼ë¡œ ë°œì†¡
```

### 1-2. FastAPIì™€ APSchedulerì˜ ì—­í•  ë¶„ë¦¬

ì´ í”„ë¡œì íŠ¸ì—ì„œ ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì—­í• ì„ ë§¡ìŠµë‹ˆë‹¤.

**FastAPI**: ì›¹ ì„œë²„ ì—­í• ì…ë‹ˆë‹¤. HTTP ìš”ì²­ì„ ë°›ê³  ì‘ë‹µì„ ëŒë ¤ì£¼ëŠ” ì„œë²„ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” `/health` (ì„œë²„ ìƒíƒœ í™•ì¸)ì™€ `/run-now` (ì¦‰ì‹œ ì‹¤í–‰ í…ŒìŠ¤íŠ¸) ë‘ ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ë§Œ ì œê³µí•©ë‹ˆë‹¤. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ "ì‚´ì•„ìˆê²Œ" ìœ ì§€í•˜ëŠ” ê»ë°ê¸° ì—­í• ë„ í•©ë‹ˆë‹¤.

**APScheduler**: ìŠ¤ì¼€ì¤„ëŸ¬ ì—­í• ì…ë‹ˆë‹¤. "ë§¤ì¼ ì˜¤ì „ 7ì‹œì— ì´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ë¼"ëŠ” ì§€ì‹œë¥¼ ë“±ë¡í•˜ê³ , ì‹œê°„ì´ ë˜ë©´ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. cron í‘œí˜„ì‹ì„ ì§€ì›í•´ì„œ ë³µì¡í•œ ìŠ¤ì¼€ì¤„ë„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ **ì™œ FastAPIë¥¼ ê»ë°ê¸°ë¡œ ì“°ë‚˜ìš”?**  
> APScheduler ë‹¨ë…ìœ¼ë¡œë„ ìŠ¤ì¼€ì¤„ ì‹¤í–‰ì€ ê°€ëŠ¥í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ FastAPIì™€ í•¨ê»˜ ì“°ë©´ ë‘ ê°€ì§€ ì´ì ì´ ìƒê¹ë‹ˆë‹¤.  
> ì²« ë²ˆì§¸, `/run-now` ê°™ì€ HTTP ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì—´ì–´ì„œ "ì§€ê¸ˆ ë‹¹ì¥ ì‹¤í–‰"ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆì–´ ê°œë°œÂ·ë””ë²„ê¹…ì´ í›¨ì”¬ ì‰½ìŠµë‹ˆë‹¤.  
> ë‘ ë²ˆì§¸, `/health` ì²´í¬ë¡œ ì„œë²„ê°€ ì‚´ì•„ìˆëŠ”ì§€ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> Dockerê°€ ì»¨í…Œì´ë„ˆë¥¼ ë„ìš¸ ë•Œë„ "HTTP ì„œë²„ê°€ ì‘ë‹µí•˜ëŠ”ê°€"ë¥¼ í—¬ìŠ¤ì²´í¬ ê¸°ì¤€ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 2. í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°

```
~/youtube-summary/
â”œâ”€â”€ docker-compose.yml    â† ì»¨í…Œì´ë„ˆ êµ¬ì„± ì •ì˜
â”œâ”€â”€ Dockerfile            â† ì´ë¯¸ì§€ ë¹Œë“œ ì„¤ê³„ë„
â”œâ”€â”€ requirements.txt      â† Python íŒ¨í‚¤ì§€ ëª©ë¡
â”œâ”€â”€ .env                  â† API í‚¤ ë“± í™˜ê²½ ë³€ìˆ˜ (Gitì— ì˜¬ë¦¬ë©´ ì•ˆ ë¨)
â””â”€â”€ app/
    â”œâ”€â”€ main.py           â† FastAPI ì•± + APScheduler ë“±ë¡
    â”œâ”€â”€ scheduler.py      â† ë§¤ì¼ ì‹¤í–‰ë˜ëŠ” ë©”ì¸ íŒŒì´í”„ë¼ì¸ ë¡œì§
    â”œâ”€â”€ youtube.py        â† YouTube Data API v3 í˜¸ì¶œ
    â”œâ”€â”€ transcript.py     â† Supadata API í˜¸ì¶œ (ìë§‰ ìˆ˜ì§‘)
    â”œâ”€â”€ summarize.py      â† Gemini API í˜¸ì¶œ (AI ìš”ì•½)
    â””â”€â”€ mailer.py         â† Gmail SMTP ì´ë©”ì¼ ë°œì†¡
```

ê° íŒŒì¼ì´ í•˜ë‚˜ì˜ ì—­í• ë§Œ ë§¡ë„ë¡ ë¶„ë¦¬í•˜ëŠ” ì´ìœ ëŠ” **ë‹¨ì¼ ì±…ì„ ì›ì¹™(Single Responsibility Principle)** ë•Œë¬¸ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‚˜ì¤‘ì— Geminië¥¼ ë‹¤ë¥¸ AIë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ `summarize.py`ë§Œ ìˆ˜ì •í•˜ë©´ ë©ë‹ˆë‹¤. ëª¨ë“  ë¡œì§ì´ í•˜ë‚˜ì˜ íŒŒì¼ì— ìˆìœ¼ë©´ ìˆ˜ì •í•  ë•Œ ë‹¤ë¥¸ ê¸°ëŠ¥ì´ ë§ê°€ì§ˆ ìœ„í—˜ì´ ì»¤ì§‘ë‹ˆë‹¤.

---

## 3. API í‚¤ ë°œê¸‰

### 3-1. YouTube Data API v3

1. [Google Cloud Console](https://console.cloud.google.com)ì— ì ‘ì†í•©ë‹ˆë‹¤.
2. ì¢Œì¸¡ ë©”ë‰´ `API ë° ì„œë¹„ìŠ¤` â†’ `ì‚¬ìš© ì„¤ì •ëœ API ë° ì„œë¹„ìŠ¤` â†’ **API ë° ì„œë¹„ìŠ¤ ì‚¬ìš© ì„¤ì •** í´ë¦­.
3. ê²€ìƒ‰ì°½ì— `YouTube Data API v3` ê²€ìƒ‰ â†’ í´ë¦­ â†’ **ì‚¬ìš©** í´ë¦­.
4. ì¢Œì¸¡ ë©”ë‰´ `ì‚¬ìš©ì ì¸ì¦ ì •ë³´` â†’ **ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°** â†’ `API í‚¤` ì„ íƒ.
5. ìƒì„±ëœ API í‚¤ë¥¼ ë³µì‚¬í•´ `.env`ì— ì €ì¥í•©ë‹ˆë‹¤.

> ğŸ’¡ **ë¬´ë£Œ í• ë‹¹ëŸ‰ì€ ì–¼ë§ˆì¸ê°€ìš”?**  
> í•˜ë£¨ 10,000 unitsì…ë‹ˆë‹¤. Search ìš”ì²­ 1íšŒì— 100 unitsê°€ ì†Œëª¨ë©ë‹ˆë‹¤. ì±„ë„ 10ê°œ Ã— í•˜ë£¨ 1íšŒ ì¡°íšŒ = 1,000 unitsë¡œ, ì¼ë°˜ì ì¸ ê°œì¸ ì‚¬ìš© ê¸°ì¤€ìœ¼ë¡œëŠ” ì ˆëŒ€ ì´ˆê³¼í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

> ğŸ’¡ **API í‚¤ ë³´ì•ˆ ì„¤ì • (ì„ íƒ ê¶Œì¥)**  
> ìƒì„±ëœ í‚¤ë¥¼ í´ë¦­ â†’ `API ì œí•œ` â†’ `YouTube Data API v3`ë§Œ ì„ íƒí•˜ë©´ ì´ í‚¤ë¡œ ë‹¤ë¥¸ Google APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤. í‚¤ê°€ ìœ ì¶œë˜ë”ë¼ë„ í”¼í•´ ë²”ìœ„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3-2. Supadata API

1. [supadata.ai](https://supadata.ai)ì— ì ‘ì†í•´ íšŒì›ê°€ì…í•©ë‹ˆë‹¤.
2. ëŒ€ì‹œë³´ë“œì—ì„œ API Keyë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.
3. ë¬´ë£Œ í”Œëœ ê¸°ì¤€ ì›” 100ê±´ì„ ì œê³µí•©ë‹ˆë‹¤. ì±„ë„ ìˆ˜ì™€ ì˜ìƒ ë¹ˆë„ì— ë”°ë¼ ìœ ë£Œ í”Œëœì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ **SupadataëŠ” ì™œ í•„ìš”í•œê°€ìš”?**  
> YouTubeì˜ ê³µì‹ APIì—ëŠ” ìë§‰ì„ í…ìŠ¤íŠ¸ë¡œ ì§ì ‘ ê°€ì ¸ì˜¤ëŠ” ì—”ë“œí¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. SupadataëŠ” YouTube ì˜ìƒ IDë¥¼ ë°›ì•„ì„œ ìë§‰ì„ íŒŒì‹±í•´ í…ìŠ¤íŠ¸ë¡œ ëŒë ¤ì£¼ëŠ” ì„œë“œíŒŒí‹° APIì…ë‹ˆë‹¤.

### 3-3. Gemini API

1. [Google AI Studio](https://aistudio.google.com)ì— ì ‘ì†í•©ë‹ˆë‹¤.
2. ì¢Œì¸¡ ë©”ë‰´ `Get API key` â†’ **API í‚¤ ë§Œë“¤ê¸°** í´ë¦­.
3. ìƒì„±ëœ í‚¤ë¥¼ ë³µì‚¬í•´ `.env`ì— ì €ì¥í•©ë‹ˆë‹¤.

> ğŸ’¡ **ë¬´ë£Œ í”Œëœ í•œë„ëŠ”?**  
> `gemini-2.5-flash` ê¸°ì¤€ ë¶„ë‹¹ 10 ìš”ì²­(RPM), í•˜ë£¨ 250 ìš”ì²­(RPD)ê¹Œì§€ ë¬´ë£Œì…ë‹ˆë‹¤. í•˜ë£¨ í•œ ë²ˆ ìˆ˜ì‹­ ê±´ì˜ ìš”ì•½ì„ ì²˜ë¦¬í•˜ëŠ” ì •ë„ëŠ” ì—¬ì „íˆ ë¬´ë£Œ í”Œëœìœ¼ë¡œ ê°€ëŠ¥í•˜ì§€ë§Œ, ì´ì „ ë²„ì „ì— ë¹„í•´ ì¼ì¼ í•œë„ê°€ í¬ê²Œ ì¤„ì—ˆìœ¼ë¯€ë¡œ(1,500ê±´ â†’ 250ê±´) ë§ì€ ì–‘ì„ í•œ ë²ˆì— ì²˜ë¦¬í•  ë•ŒëŠ” í•œë„ ì´ˆê³¼ì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

### 3-4. Gmail ì•± ë¹„ë°€ë²ˆí˜¸

ì¼ë°˜ Gmail ë¹„ë°€ë²ˆí˜¸ëŠ” SMTP ì ‘ì†ì— ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. "ì•± ë¹„ë°€ë²ˆí˜¸"ë¼ëŠ” ë³„ë„ì˜ 16ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°œê¸‰í•´ì•¼ í•©ë‹ˆë‹¤.

1. [Google ê³„ì •](https://myaccount.google.com) â†’ `ë³´ì•ˆ` íƒ­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. **2ë‹¨ê³„ ì¸ì¦**ì´ í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ë¹„í™œì„±í™” ìƒíƒœë¼ë©´ ë¨¼ì € ì„¤ì •í•˜ì„¸ìš”.
3. ê²€ìƒ‰ì°½ì— `ì•± ë¹„ë°€ë²ˆí˜¸` ê²€ìƒ‰ â†’ ì•± ì´ë¦„ì— `youtube-summary` ë“± ì„ì˜ ì´ë¦„ ì…ë ¥ â†’ **ë§Œë“¤ê¸°** í´ë¦­.
4. í‘œì‹œëœ 16ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê³µë°± ì—†ì´ ë³µì‚¬í•´ `.env`ì— ì €ì¥í•©ë‹ˆë‹¤.

> âš ï¸ **ì•± ë¹„ë°€ë²ˆí˜¸ëŠ” í•œ ë²ˆë§Œ í‘œì‹œë©ë‹ˆë‹¤.** ì°½ì„ ë‹«ìœ¼ë©´ ë‹¤ì‹œ ë³¼ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì¦‰ì‹œ `.env`ì— ì €ì¥í•˜ì„¸ìš”. ìƒì–´ë²„ë¦¬ë©´ ìƒˆë¡œ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

---

## 4. íŒŒì¼ ì‘ì„± - ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…

### 4-1. requirements.txt

```txt
fastapi
uvicorn[standard]
apscheduler
httpx
pytz
google-genai
```

**ê° íŒ¨í‚¤ì§€ ì—­í• :**

| íŒ¨í‚¤ì§€ | ì—­í•  |
|---|---|
| `fastapi` | ì›¹ í”„ë ˆì„ì›Œí¬. HTTP ì„œë²„ ë° ì—”ë“œí¬ì¸íŠ¸ ì œê³µ |
| `uvicorn[standard]` | FastAPIë¥¼ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ëŠ” ASGI ì„œë²„. `[standard]`ë¥¼ ë¶™ì´ë©´ ì„±ëŠ¥ ìµœì í™” íŒ¨í‚¤ì§€(uvloop, httptools)ê°€ í•¨ê»˜ ì„¤ì¹˜ë¨ |
| `apscheduler` | ìŠ¤ì¼€ì¤„ëŸ¬ ë¼ì´ë¸ŒëŸ¬ë¦¬. cron ë°©ì‹ ë“± ë‹¤ì–‘í•œ ìŠ¤ì¼€ì¤„ ë°©ì‹ ì§€ì› |
| `httpx` | ë¹„ë™ê¸°(async) HTTP ìš”ì²­ ë¼ì´ë¸ŒëŸ¬ë¦¬. YouTube, Supadata API í˜¸ì¶œì— ì‚¬ìš© |
| `pytz` | íƒ€ì„ì¡´ ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬. APSchedulerì˜ Asia/Seoul ì„¤ì •ì— í•„ìš” |
| `google-genai` | Google ê³µì‹ Gemini SDK. Gemini API í˜¸ì¶œì— ì‚¬ìš© |

> ğŸ’¡ **`httpx`ë¥¼ ì“°ëŠ” ì´ìœ ëŠ” ë­”ê°€ìš”? `requests`ëŠ” ì•ˆ ë˜ë‚˜ìš”?**  
> `requests`ëŠ” ë™ê¸°(synchronous) ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. FastAPIëŠ” ë¹„ë™ê¸°(async) í™˜ê²½ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ë°, ë¹„ë™ê¸° í•¨ìˆ˜ ì•ˆì—ì„œ ë™ê¸° HTTP ìš”ì²­ì„ í•˜ë©´ ë‹¤ë¥¸ ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ê³  "ë¸”ë¡œí‚¹" ìƒíƒœê°€ ë©ë‹ˆë‹¤. `httpx`ëŠ” `async with`ë¥¼ ì§€ì›í•˜ëŠ” ë¹„ë™ê¸° í´ë¼ì´ì–¸íŠ¸ë¼ì„œ FastAPI í™˜ê²½ì— ì í•©í•©ë‹ˆë‹¤.

---

### 4-2. .env

```env
YOUTUBE_API_KEY=ì—¬ê¸°ì—_ìœ íŠœë¸Œ_API_í‚¤_ì…ë ¥
SUPADATA_API_KEY=ì—¬ê¸°ì—_Supadata_API_í‚¤_ì…ë ¥
GEMINI_API_KEY=ì—¬ê¸°ì—_Gemini_API_í‚¤_ì…ë ¥
GMAIL_USER=your@gmail.com
GMAIL_APP_PASSWORD=xxxxxxxxxxxxxxxxxxxx
RECIPIENT_EMAIL=ë°›ì„ì´ë©”ì¼@example.com
CHANNEL_IDS=UCxxx,UCyyy,UCzzz
```

**`CHANNEL_IDS` ì…ë ¥ ë°©ë²•:**

ìœ íŠœë¸Œ ì±„ë„ IDëŠ” `UC`ë¡œ ì‹œì‘í•˜ëŠ” 24ìë¦¬ ë¬¸ìì—´ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ì±„ë„ì€ ì‰¼í‘œë¡œ êµ¬ë¶„í•©ë‹ˆë‹¤.

ì±„ë„ IDë¥¼ ì°¾ëŠ” ë°©ë²•:
- ìœ íŠœë¸Œ ì±„ë„ í˜ì´ì§€ ì ‘ì† â†’ ì£¼ì†Œì°½ì— `/channel/UCxxx...` í˜•íƒœë¼ë©´ ê·¸ê²Œ ì±„ë„ ID
- `@ì±„ë„ëª…` í˜•íƒœì˜ ì»¤ìŠ¤í…€ URLì´ë¼ë©´: ì±„ë„ í˜ì´ì§€ì—ì„œ `Ctrl+U`ë¡œ ì†ŒìŠ¤ ë³´ê¸° â†’ `channelId` ê²€ìƒ‰

> âš ï¸ **`.env` íŒŒì¼ì€ Gitì— ì ˆëŒ€ ì˜¬ë¦¬ë©´ ì•ˆ ë©ë‹ˆë‹¤.** `.gitignore` íŒŒì¼ì— `.env`ë¥¼ ì¶”ê°€í•´ë‘ì„¸ìš”.  
> API í‚¤ê°€ GitHubì— ê³µê°œë˜ë©´ ìë™ ìŠ¤ìºë„ˆì— ì˜í•´ ìˆ˜ ë¶„ ë‚´ì— ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 4-3. app/main.py

```python
from fastapi import FastAPI
from contextlib import asynccontextmanager
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.triggers.cron import CronTrigger
from app.scheduler import run_daily_summary
import pytz

# ìŠ¤ì¼€ì¤„ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (íƒ€ì„ì¡´ì„ ì„œìš¸ë¡œ ê³ ì •)
scheduler = AsyncIOScheduler(timezone=pytz.timezone("Asia/Seoul"))


@asynccontextmanager
async def lifespan(app: FastAPI):
    """
    FastAPI ì„œë²„ì˜ ì‹œì‘ê³¼ ì¢…ë£Œ ì‹œì ì— ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    with ë¸”ë¡ ì•(yield ì´ì „)ì€ ì„œë²„ ì‹œì‘ ì‹œ, ë’¤(yield ì´í›„)ëŠ” ì„œë²„ ì¢…ë£Œ ì‹œ ì‹¤í–‰ë©ë‹ˆë‹¤.
    """
    # --- ì„œë²„ ì‹œì‘ ì‹œ ì‹¤í–‰ ---
    scheduler.add_job(
        run_daily_summary,                    # ì‹¤í–‰í•  í•¨ìˆ˜
        CronTrigger(hour=7, minute=0),        # ë§¤ì¼ 07:00 KST
        id="daily_summary",                   # ì¡ ì‹ë³„ì (ì¤‘ë³µ ë°©ì§€)
        replace_existing=True,                # ê°™ì€ idê°€ ìˆìœ¼ë©´ ë®ì–´ì”€
    )
    scheduler.start()
    print("âœ… APScheduler ì‹œì‘ë¨. ë§¤ì¼ 07:00 KSTì— ì‹¤í–‰ë©ë‹ˆë‹¤.")

    yield  # â† ì´ ì§€ì ì—ì„œ FastAPI ì„œë²„ê°€ ì‹¤ì œë¡œ ì‹¤í–‰ë¨

    # --- ì„œë²„ ì¢…ë£Œ ì‹œ ì‹¤í–‰ ---
    scheduler.shutdown()
    print("ğŸ›‘ APScheduler ì¢…ë£Œë¨.")


app = FastAPI(lifespan=lifespan)


@app.get("/health")
def health():
    """ì„œë²„ ìƒíƒœ í™•ì¸ ì—”ë“œí¬ì¸íŠ¸"""
    return {"status": "ok"}


@app.post("/run-now")
async def run_now():
    """
    í…ŒìŠ¤íŠ¸ìš© ì¦‰ì‹œ ì‹¤í–‰ ì—”ë“œí¬ì¸íŠ¸.
    ìŠ¤ì¼€ì¤„ ì‹œê°„ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  íŒŒì´í”„ë¼ì¸ì„ ë°”ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
    curl -X POST http://<ì„œë²„IP>:8000/run-now ìœ¼ë¡œ í˜¸ì¶œ ê°€ëŠ¥
    """
    await run_daily_summary()
    return {"status": "done"}
```

> ğŸ’¡ **`lifespan`ì´ë€?**  
> FastAPI ì„œë²„ê°€ ì‹œì‘ë  ë•Œ(startup)ì™€ ì¢…ë£Œë  ë•Œ(shutdown) ì‹¤í–‰í•  ì½”ë“œë¥¼ ì •ì˜í•˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ì²˜ëŸ¼ ì„œë²„ì™€ ìƒëª… ì£¼ê¸°ë¥¼ ê°™ì´í•´ì•¼ í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì—¬ê¸°ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤. `yield` ì•ì— ìˆëŠ” ì½”ë“œê°€ startup, ë’¤ê°€ shutdownì…ë‹ˆë‹¤.

> ğŸ’¡ **`AsyncIOScheduler`ë¥¼ ì“°ëŠ” ì´ìœ ëŠ”?**  
> APSchedulerì—ëŠ” ì—¬ëŸ¬ ìŠ¤ì¼€ì¤„ëŸ¬ íƒ€ì…ì´ ìˆìŠµë‹ˆë‹¤. `BlockingScheduler`ëŠ” ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ì ìœ í•´ì„œ FastAPIê°€ ë™ì‹œì— ëŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. `AsyncIOScheduler`ëŠ” Pythonì˜ asyncio ì´ë²¤íŠ¸ ë£¨í”„ ìœ„ì—ì„œ ë™ì‘í•´ì„œ FastAPIì™€ ê°™ì€ ë£¨í”„ë¥¼ ê³µìœ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆì—ë„ FastAPIëŠ” HTTP ìš”ì²­ì„ ì •ìƒ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ **`/run-now` ì—”ë“œí¬ì¸íŠ¸ê°€ ì™œ ì¤‘ìš”í•œê°€ìš”?**  
> ê°œë°œ ê³¼ì •ì—ì„œ ë§¤ì¼ 07:00ì„ ê¸°ë‹¤ë¦´ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ë©´ ì¦‰ì‹œ ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ ì‹¤í–‰ë˜ë¯€ë¡œ, ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  ë°”ë¡œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œëŠ” ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•˜ì§€ ì•Šë„ë¡ ë‚˜ì¤‘ì— ì¸ì¦ì„ ì¶”ê°€í•˜ê±°ë‚˜ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 4-4. app/scheduler.py

```python
import os
from app.youtube import get_recent_videos
from app.transcript import get_transcript
from app.summarize import summarize
from app.mailer import send_email

# í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì±„ë„ ID ëª©ë¡ì„ ì½ì–´ì˜´
# "UCxxx,UCyyy,UCzzz" â†’ ["UCxxx", "UCyyy", "UCzzz"]
CHANNEL_IDS = [cid.strip() for cid in os.getenv("CHANNEL_IDS", "").split(",") if cid.strip()]


async def run_daily_summary():
    """
    ë§¤ì¼ ì‹¤í–‰ë˜ëŠ” ë©”ì¸ íŒŒì´í”„ë¼ì¸.
    ì±„ë„ ëª©ë¡ì„ ìˆœíšŒí•˜ë©° ì˜ìƒ ìˆ˜ì§‘ â†’ ìë§‰ â†’ ìš”ì•½ â†’ ì´ë©”ì¼ ë°œì†¡ê¹Œì§€ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    """
    print("=" * 40)
    print("ğŸ“º ìœ íŠœë¸Œ ìš”ì•½ íŒŒì´í”„ë¼ì¸ ì‹œì‘")
    print("=" * 40)

    results = []  # ìµœì¢… ì´ë©”ì¼ì— ë‹´ê¸¸ ìš”ì•½ ê²°ê³¼ ëª©ë¡

    for channel_id in CHANNEL_IDS:
        print(f"\nğŸ“¡ ì±„ë„ ì²˜ë¦¬ ì¤‘: {channel_id}")

        # 1ë‹¨ê³„: í•´ë‹¹ ì±„ë„ì˜ ìµœê·¼ 24ì‹œê°„ ì˜ìƒ ì¡°íšŒ
        videos = await get_recent_videos(channel_id)
        print(f"  â†’ ì‹ ê·œ ì˜ìƒ {len(videos)}ê°œ ë°œê²¬")

        if not videos:
            continue  # ì´ ì±„ë„ì— ìƒˆ ì˜ìƒì´ ì—†ìœ¼ë©´ ë‹¤ìŒ ì±„ë„ë¡œ

        for video in videos:
            print(f"\n  ğŸ¬ ì²˜ë¦¬: {video['title']}")

            # 2ë‹¨ê³„: ìë§‰ ê°€ì ¸ì˜¤ê¸°
            transcript = await get_transcript(video["video_id"])

            if not transcript:
                print(f"     â†’ âš ï¸ ìë§‰ ì—†ìŒ, ìŠ¤í‚µ")
                continue  # ìë§‰ì´ ì—†ìœ¼ë©´ ìš”ì•½ ë¶ˆê°€ â†’ ë‹¤ìŒ ì˜ìƒìœ¼ë¡œ

            print(f"     â†’ ìë§‰ {len(transcript)}ì ìˆ˜ì§‘ ì™„ë£Œ")

            # 3ë‹¨ê³„: AI ìš”ì•½
            summary = await summarize(transcript, video["title"])
            print(f"     â†’ ìš”ì•½ ì™„ë£Œ")

            # ê²°ê³¼ ì €ì¥
            results.append({
                "title": video["title"],
                "link": video["link"],
                "channel": video["channel"],
                "summary": summary,
            })

    # 4ë‹¨ê³„: ì´ë©”ì¼ ë°œì†¡
    print(f"\nğŸ“§ ì´ {len(results)}ê°œ ì˜ìƒ ìš”ì•½ ì™„ë£Œ")

    if results:
        await send_email(results)
        print("âœ… ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ")
    else:
        print("â„¹ï¸ ë°œì†¡í•  ë‚´ìš© ì—†ìŒ (ì˜¤ëŠ˜ ìƒˆ ì˜ìƒ ì—†ê±°ë‚˜ ëª¨ë‘ ìë§‰ ì—†ìŒ)")

    print("=" * 40)
```

> ğŸ’¡ **`for channel_id in CHANNEL_IDS:` â€” n8nì˜ Loop Over Itemsì™€ ê°™ìŠµë‹ˆë‹¤.**  
> n8nì—ì„œ ì±„ë„ ëª©ë¡ì„ ë£¨í”„ ëŒë¦¬ê³ , ê·¸ ì•ˆì—ì„œ ë‹¤ì‹œ ì˜ìƒ ëª©ë¡ì„ ë£¨í”„ ëŒë ¸ë˜ ê²ƒì„ Pythonì˜ ì¤‘ì²© `for` ë£¨í”„ë¡œ í‘œí˜„í•©ë‹ˆë‹¤. ì½”ë“œê°€ í›¨ì”¬ ì§ê´€ì ì´ê³ , ì˜¤ë¥˜ ë°œìƒ ì‹œ `continue`ë¡œ í•´ë‹¹ í•­ëª©ë§Œ ê±´ë„ˆë›°ëŠ” ì²˜ë¦¬ë„ ê°„ë‹¨í•©ë‹ˆë‹¤.

> ğŸ’¡ **`if not transcript: continue`ê°€ n8nì˜ Filter ë…¸ë“œ ì—­í• ì…ë‹ˆë‹¤.**  
> n8nì—ì„œ IF ë…¸ë“œë¡œ ìë§‰ ìœ ë¬´ë¥¼ í™•ì¸í•˜ê³  False ë¶„ê¸°ëŠ” ë²„ë ¸ë˜ ê²ƒì„ `continue` í•œ ì¤„ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

### 4-5. app/youtube.py

```python
import httpx
import os
import re
from datetime import datetime, timedelta, timezone

YOUTUBE_API_KEY = os.getenv("YOUTUBE_API_KEY")
YOUTUBE_SEARCH_URL = "https://www.googleapis.com/youtube/v3/search"
YOUTUBE_VIDEOS_URL = "https://www.googleapis.com/youtube/v3/videos"


def parse_duration_seconds(iso_duration: str) -> int:
    """
    ISO 8601 í˜•ì‹ì˜ duration ë¬¸ìì—´ì„ ì´ˆ ë‹¨ìœ„ ì •ìˆ˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    ì˜ˆ: "PT1M30S" â†’ 90, "PT30S" â†’ 30, "PT10M" â†’ 600
    """
    match = re.match(r'PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?', iso_duration)
    if not match:
        return 0
    hours = int(match.group(1) or 0)
    minutes = int(match.group(2) or 0)
    seconds = int(match.group(3) or 0)
    return hours * 3600 + minutes * 60 + seconds


async def is_shorts_by_redirect(video_id: str) -> bool:
    """
    URL ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ ì‡¼ì¸  ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    200 â†’ ì‡¼ì¸ , 3xx â†’ ì¼ë°˜ ì˜ìƒ
    """
    url = f"https://www.youtube.com/shorts/{video_id}"
    async with httpx.AsyncClient(follow_redirects=False) as client:
        response = await client.get(url)
    return response.status_code == 200


async def filter_shorts(video_ids: list[str]) -> set[str]:
    """
    ì˜ìƒ ID ëª©ë¡ì„ ë°›ì•„ì„œ ì‡¼ì¸ ì— í•´ë‹¹í•˜ëŠ” ID ì§‘í•©ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    - 60ì´ˆ ì´í•˜ â†’ durationë§Œìœ¼ë¡œ ì‡¼ì¸  íŒì •
    - 60ì´ˆ ì´ˆê³¼ ~ 3ë¶„ ì´í•˜ â†’ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ 2ì°¨ í™•ì¸ (ì‡¼ì¸  ìµœëŒ€ ê¸¸ì´ 3ë¶„)
    - 3ë¶„ ì´ˆê³¼ â†’ ì¼ë°˜ ì˜ìƒìœ¼ë¡œ íŒì •, ì¶”ê°€ í™•ì¸ ì—†ìŒ
    """
    params = {
        "key": YOUTUBE_API_KEY,
        "id": ",".join(video_ids),  # í•œ ë²ˆì— ìµœëŒ€ 50ê°œê¹Œì§€ ì¡°íšŒ ê°€ëŠ¥
        "part": "contentDetails",
    }

    async with httpx.AsyncClient() as client:
        response = await client.get(YOUTUBE_VIDEOS_URL, params=params)
        response.raise_for_status()

    data = response.json()
    shorts_ids = set()

    for item in data.get("items", []):
        video_id = item["id"]
        duration_str = item["contentDetails"]["duration"]
        duration_sec = parse_duration_seconds(duration_str)

        if duration_sec <= 60:
            # 60ì´ˆ ì´í•˜ â†’ ë¬´ì¡°ê±´ ì‡¼ì¸ 
            shorts_ids.add(video_id)
        elif duration_sec <= 180:
            # 60ì´ˆ ì´ˆê³¼ ~ 3ë¶„ ì´í•˜ â†’ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ 2ì°¨ í™•ì¸
            if await is_shorts_by_redirect(video_id):
                shorts_ids.add(video_id)
        # 3ë¶„ ì´ˆê³¼ â†’ ë¬´ì¡°ê±´ ì¼ë°˜ ì˜ìƒ, ì²´í¬ ì•ˆ í•¨

    return shorts_ids


async def get_recent_videos(channel_id: str) -> list[dict]:
    """
    ì£¼ì–´ì§„ ì±„ë„ IDì—ì„œ ìµœê·¼ 24ì‹œê°„ ë‚´ ì—…ë¡œë“œëœ ì˜ìƒ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    ì‡¼ì¸ ëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.
    """
    since = (datetime.now(timezone.utc) - timedelta(days=1)).isoformat()

    params = {
        "key": YOUTUBE_API_KEY,
        "channelId": channel_id,
        "part": "snippet",
        "order": "date",
        "publishedAfter": since,
        "maxResults": 5,
        "type": "video",
    }

    async with httpx.AsyncClient() as client:
        response = await client.get(YOUTUBE_SEARCH_URL, params=params)
        response.raise_for_status()

    data = response.json()
    items = data.get("items", [])

    if not items:
        return []

    # ì‡¼ì¸  í•„í„°ë§
    video_ids = [item["id"]["videoId"] for item in items]
    shorts_ids = await filter_shorts(video_ids)

    videos = []
    for item in items:
        video_id = item["id"]["videoId"]
        if video_id in shorts_ids:
            print(f"     â†’ â­ ì‡¼ì¸  ì œì™¸: {item['snippet']['title']}")
            continue
        snippet = item["snippet"]
        videos.append({
            "video_id": video_id,
            "title": snippet["title"],
            "channel": snippet["channelTitle"],
            "link": f"https://www.youtube.com/watch?v={video_id}",
        })

    return videos
```

> ğŸ’¡ **`publishedAfter`ë¡œ ì„œë²„ ì¸¡ í•„í„°ë§ì„ í•©ë‹ˆë‹¤.**  
> n8nì—ì„œëŠ” YouTube APIë¡œ ì˜ìƒ ëª©ë¡ì„ ë°›ì•„ì˜¨ ë’¤ ë³„ë„ì˜ Filter ë…¸ë“œë¡œ 24ì‹œê°„ ì´ë‚´ ì˜ìƒì„ ê±¸ë €ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” YouTube API ìì²´ì— `publishedAfter` íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•´ì„œ, 24ì‹œê°„ ë‚´ ì˜ìƒë§Œ ì²˜ìŒë¶€í„° ë°›ì•„ì˜µë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ë°ì´í„°ë¥¼ ë°›ì§€ ì•Šìœ¼ë‹ˆ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤.

> ğŸ’¡ **YouTube APIì— ì‡¼ì¸  í•„í„° ì˜µì…˜ì´ ì—†ë‚˜ìš”?**  
> ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ 2ë‹¨ê³„ í•„í„°ë§ ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¨¼ì € `videos` APIë¡œ ì˜ìƒ ê¸¸ì´(duration)ë¥¼ ì¡°íšŒí•´ 60ì´ˆ ì´í•˜ëŠ” ì‡¼ì¸ ë¡œ ì¦‰ì‹œ íŒì •í•©ë‹ˆë‹¤. ì‡¼ì¸  ìµœëŒ€ ê¸¸ì´ê°€ 3ë¶„ìœ¼ë¡œ ëŠ˜ì–´ë‚¬ê¸° ë•Œë¬¸ì—, 60ì´ˆ ì´ˆê³¼ ~ 3ë¶„ ì´í•˜ êµ¬ê°„ì€ `https://www.youtube.com/shorts/{video_id}` URLì— ìš”ì²­ì„ ë³´ë‚´ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì—¬ë¶€ë¡œ 2ì°¨ í™•ì¸í•©ë‹ˆë‹¤. 200ì´ ë°˜í™˜ë˜ë©´ ì‡¼ì¸ , 3xx ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë°˜í™˜ë˜ë©´ ì¼ë°˜ ì˜ìƒì…ë‹ˆë‹¤. 3ë¶„ ì´ˆê³¼ ì˜ìƒì€ ì¶”ê°€ í™•ì¸ ì—†ì´ ì¼ë°˜ ì˜ìƒìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

> ğŸ’¡ **`filter_shorts()`ì—ì„œ APIë¥¼ ë‘ ë²ˆ í˜¸ì¶œí•˜ì§€ ì•Šë‚˜ìš”?**  
> `videos` API í˜¸ì¶œì€ ì˜ìƒ ì „ì²´ë¥¼ IDë¥¼ ì‰¼í‘œë¡œ ì´ì–´ í•œ ë²ˆì— ë¬¶ì–´ì„œ ì¡°íšŒí•©ë‹ˆë‹¤. ì¶”ê°€ quota ì†Œëª¨ëŠ” ì±„ë„ë‹¹ 1 unitìœ¼ë¡œ ë§¤ìš° ì €ë ´í•©ë‹ˆë‹¤. ë¦¬ë‹¤ì´ë ‰íŠ¸ í™•ì¸ì€ 60ì´ˆ~3ë¶„ êµ¬ê°„ ì˜ìƒì—ë§Œ ì´ë£¨ì–´ì§€ë¯€ë¡œ, ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì¶”ê°€ HTTP ìš”ì²­ì€ 0~1íšŒì— ê·¸ì¹©ë‹ˆë‹¤.

> ğŸ’¡ **`async with httpx.AsyncClient() as client:`ëŠ” ë¬´ìŠ¨ ì˜ë¯¸ì¸ê°€ìš”?**  
> `async with`ëŠ” ë¹„ë™ê¸° ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤. ë¸”ë¡ì´ ëë‚˜ë©´ HTTP ì—°ê²°ì„ ìë™ìœ¼ë¡œ ì •ë¦¬(close)í•´ì¤ë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ `client.close()`ë¥¼ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ì–´ì„œ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.

> ğŸ’¡ **`response.raise_for_status()`ëŠ” ì™œ ì“°ë‚˜ìš”?**  
> HTTP ì‘ë‹µ ì½”ë“œê°€ 400 ì´ìƒ(ì—ëŸ¬)ì´ë©´ ìë™ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. ì´ê²Œ ì—†ìœ¼ë©´ API í‚¤ê°€ ì˜ëª»ë˜ê±°ë‚˜ í• ë‹¹ëŸ‰ì´ ì´ˆê³¼ë¼ë„ ì½”ë“œê°€ ê·¸ëƒ¥ ë¹ˆ ê²°ê³¼ë¥¼ ëŒë ¤ì£¼ê³  ì§€ë‚˜ì¹©ë‹ˆë‹¤. ì—ëŸ¬ë¥¼ ì¦‰ì‹œ í™•ì¸í•˜ê¸° ìœ„í•´ ë„£ìŠµë‹ˆë‹¤.

---

### 4-6. app/transcript.py

```python
import httpx
import os

SUPADATA_API_KEY = os.getenv("SUPADATA_API_KEY")
SUPADATA_URL = "https://api.supadata.ai/v1/youtube/transcript"


async def get_transcript(video_id: str) -> str | None:
    """
    Supadata APIë¥¼ í†µí•´ ìœ íŠœë¸Œ ì˜ìƒì˜ ìë§‰ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    ìë§‰ì´ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ Noneì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    headers = {"x-api-key": SUPADATA_API_KEY}
    params = {
        "videoId": video_id,
        "lang": "ko",   # í•œêµ­ì–´ ìë§‰ ìš°ì„  ìš”ì²­. ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì–¸ì–´ë„ ë°˜í™˜ë  ìˆ˜ ìˆìŒ
        "text": "true", # íƒ€ì„ìŠ¤íƒ¬í”„ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ ë°˜í™˜
    }

    async with httpx.AsyncClient(timeout=20) as client:
        response = await client.get(SUPADATA_URL, headers=headers, params=params)

    # ìë§‰ì´ ì—†ëŠ” ê²½ìš° 404ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ, ì˜ˆì™¸ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  None ë°˜í™˜
    if response.status_code == 404:
        return None

    # ê·¸ ì™¸ ì—ëŸ¬(ì¸ì¦ ì‹¤íŒ¨, ì„œë²„ ì˜¤ë¥˜ ë“±)ëŠ” ì˜ˆì™¸ ë°œìƒ
    if response.status_code != 200:
        print(f"  Supadata ì˜¤ë¥˜: {response.status_code} - {response.text}")
        return None

    data = response.json()
    content = data.get("content", "")

    # contentê°€ ë¹ˆ ë¬¸ìì—´ì´ë©´ None ë°˜í™˜
    return content if content else None
```

> ğŸ’¡ **ì™œ 404ë¥¼ ì˜ˆì™¸ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  `None`ìœ¼ë¡œ ë°˜í™˜í•˜ë‚˜ìš”?**  
> 404ëŠ” "ìë§‰ì´ ì—†ëŠ” ì˜ìƒ"ì„ ì˜ë¯¸í•˜ëŠ” ì •ìƒì ì¸ ì¼€ì´ìŠ¤ì…ë‹ˆë‹¤. ì˜ˆì™¸ë¡œ ì²˜ë¦¬í•˜ë©´ ìŠ¤ì¼€ì¤„ëŸ¬ ì „ì²´ê°€ ë©ˆì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì‹  `None`ì„ ë°˜í™˜í•´ì„œ `scheduler.py`ì—ì„œ `if not transcript: continue`ë¡œ í•´ë‹¹ ì˜ìƒë§Œ ìŠ¤í‚µí•˜ê²Œ í•©ë‹ˆë‹¤.

> ğŸ’¡ **`timeout=20`ì€ ë¬´ì—‡ì¸ê°€ìš”?**  
> 20ì´ˆ ì´ë‚´ì— ì‘ë‹µì´ ì—†ìœ¼ë©´ ìš”ì²­ì„ í¬ê¸°í•©ë‹ˆë‹¤. íƒ€ì„ì•„ì›ƒì´ ì—†ìœ¼ë©´ ì™¸ë¶€ APIê°€ ì‘ë‹µí•˜ì§€ ì•Šì„ ë•Œ ì½”ë“œê°€ ì˜ì›íˆ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 4-7. app/summarize.py

```python
import os
from google import genai

# ëª¨ë“ˆ ë¡œë“œ ì‹œ í´ë¼ì´ì–¸íŠ¸ë¥¼ í•œ ë²ˆë§Œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
# ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ì–´ì„œ íš¨ìœ¨ì ì…ë‹ˆë‹¤.
client = genai.Client(api_key=os.getenv("GEMINI_API_KEY"))

PROMPT_TEMPLATE = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì˜ìƒì„ ë¶„ì„í•´ ë…ìì—ê²Œ ì˜ìƒì˜ ëª¨ë“  í•µì‹¬ì„ ì „ë‹¬í•˜ëŠ” ì „ë¬¸ ì—ë””í„°ì…ë‹ˆë‹¤.
ì•„ë˜ëŠ” ì˜ìƒ "{title}"ì˜ ìë§‰ ì „ë¬¸ì…ë‹ˆë‹¤.

ì´ ì˜ìƒì„ ë³´ì§€ ì•Šì€ ì‚¬ëŒë„ ë‚´ìš©ì„ ì™„ì „íˆ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.

## ğŸ“Œ í•œ ì¤„ ìš”ì•½
ì˜ìƒ ì „ì²´ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì••ì¶•í•´ì£¼ì„¸ìš”.

## ğŸ—‚ ë°°ê²½ ë° ë§¥ë½
ì´ ì˜ìƒì´ ë‹¤ë£¨ëŠ” ì£¼ì œì˜ ë°°ê²½, ì‚¬íšŒì /ê²½ì œì  ë§¥ë½, ì™œ ì§€ê¸ˆ ì´ ì£¼ì œê°€ ì¤‘ìš”í•œì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”. (3~5ë¬¸ì¥)

## ğŸ” í•µì‹¬ ë‚´ìš©
ì˜ìƒì—ì„œ ë‹¤ë£¨ëŠ” í•µì‹¬ ë…¼ì , ì£¼ì¥, ë°ì´í„°, ì‚¬ë¡€ë¥¼ ë¹ ì§ì—†ì´ ì •ë¦¬í•´ì£¼ì„¸ìš”.
ê° í•­ëª©ì€ ì†Œì œëª©ê³¼ í•¨ê»˜ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. (ìµœì†Œ 5ê°œ í•­ëª©)

## ğŸ’¡ ì¸ì‚¬ì´íŠ¸ ë° ì‹œì‚¬ì 
ì´ ì˜ìƒì´ ì „ë‹¬í•˜ë ¤ëŠ” ë©”ì‹œì§€, ì‹œì²­ìê°€ ì–»ì–´ê°ˆ ìˆ˜ ìˆëŠ” êµí›ˆì´ë‚˜ ê´€ì ì„ ì •ë¦¬í•´ì£¼ì„¸ìš”. (3~5ë¬¸ì¥)

---
{transcript}
"""


async def summarize(transcript: str, title: str) -> str:
    truncated_transcript = transcript[:20000]

    prompt = PROMPT_TEMPLATE.format(
        title=title,
        transcript=truncated_transcript,
    )

    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=prompt,
    )

    return response.text
```

> ğŸ’¡ **ì™œ `google-genai` SDKë¥¼ ì“°ë‚˜ìš”?**  
> ê¸°ì¡´ì—ëŠ” `httpx`ë¡œ Gemini REST APIë¥¼ ì§ì ‘ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤. SDKë¥¼ ì“°ë©´ HTTP í†µì‹ , ì¸ì¦, ì‘ë‹µ íŒŒì‹±ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤˜ì„œ ì½”ë“œê°€ í›¨ì”¬ ë‹¨ìˆœí•´ì§‘ë‹ˆë‹¤. ì‘ë‹µ í…ìŠ¤íŠ¸ë„ `data["candidates"][0]["content"]["parts"][0]["text"]` ê°™ì€ ë³µì¡í•œ ê²½ë¡œ ëŒ€ì‹  `response.text` í•œ ì¤„ë¡œ êº¼ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ **`client`ë¥¼ í•¨ìˆ˜ ë°–ì—ì„œ ì´ˆê¸°í™”í•˜ëŠ” ì´ìœ ëŠ”?**  
> `summarize()` í•¨ìˆ˜ëŠ” ì˜ìƒ ìˆ˜ë§Œí¼ ë°˜ë³µ í˜¸ì¶œë©ë‹ˆë‹¤. í•¨ìˆ˜ ì•ˆì—ì„œ `genai.Client()`ë¥¼ ë§Œë“¤ë©´ í˜¸ì¶œë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ ê°ì²´ê°€ ìƒˆë¡œ ìƒì„±ë©ë‹ˆë‹¤. ëª¨ë“ˆ ìµœìƒë‹¨ì—ì„œ í•œ ë²ˆë§Œ ì´ˆê¸°í™”í•˜ë©´ ì´ ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ **`temperature` ì„¤ì •ì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?**  
> `google-genai` SDKì—ì„œëŠ” `GenerateContentConfig`ë¥¼ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ìœ¼ë¡œë„ ìš”ì•½ í’ˆì§ˆì´ ì¶©ë¶„í•˜ì§€ë§Œ, ì§ì ‘ ì¡°ì •í•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.
> ```python
> from google.genai import types
> 
> response = client.models.generate_content(
>     model="gemini-2.5-flash",
>     contents=prompt,
>     config=types.GenerateContentConfig(temperature=0.4),
> )
> ```

---

### 4-8. app/mailer.py

```python
import smtplib
import os
import re
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from datetime import date

GMAIL_USER = os.getenv("GMAIL_USER")
GMAIL_APP_PASSWORD = os.getenv("GMAIL_APP_PASSWORD")
RECIPIENT_EMAIL = os.getenv("RECIPIENT_EMAIL")


def markdown_to_html(text: str) -> str:
    """
    Geminiê°€ ë°˜í™˜í•˜ëŠ” ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    """
    lines = text.split("\n")
    html_lines = []
    in_list = False  # í˜„ì¬ <ul> íƒœê·¸ê°€ ì—´ë ¤ìˆëŠ”ì§€ ì¶”ì 

    for line in lines:
        # --- ì œëª© ì²˜ë¦¬ (## ì œëª©) ---
        if line.startswith("## "):
            if in_list:
                html_lines.append("</ul>")
                in_list = False
            content = line[3:].strip()
            html_lines.append(f'<h3 style="margin: 20px 0 8px; color: #111;">{content}</h3>')

        # --- ë¶ˆë¦¿ í•­ëª© ì²˜ë¦¬ (- í•­ëª© ë˜ëŠ” * í•­ëª©) ---
        elif line.startswith("- ") or line.startswith("* "):
            if not in_list:
                html_lines.append('<ul style="margin: 8px 0; padding-left: 20px; line-height: 1.9;">')
                in_list = True
            content = line[2:].strip()
            # **êµµê²Œ** ì²˜ë¦¬
            content = re.sub(r'\*\*(.+?)\*\*', r'<strong>\1</strong>', content)
            html_lines.append(f'<li style="margin-bottom: 6px;">{content}</li>')

        # --- êµ¬ë¶„ì„  (---) ---
        elif line.strip() == "---":
            if in_list:
                html_lines.append("</ul>")
                in_list = False

        # --- ë¹ˆ ì¤„ ---
        elif line.strip() == "":
            if in_list:
                html_lines.append("</ul>")
                in_list = False
            html_lines.append("")

        # --- ì¼ë°˜ í…ìŠ¤íŠ¸ ---
        else:
            if in_list:
                html_lines.append("</ul>")
                in_list = False
            content = line.strip()
            # **êµµê²Œ** ì²˜ë¦¬
            content = re.sub(r'\*\*(.+?)\*\*', r'<strong>\1</strong>', content)
            if content:
                html_lines.append(f'<p style="margin: 6px 0; line-height: 1.8;">{content}</p>')

    # ë§ˆì§€ë§‰ì— ì—´ë¦° <ul>ì´ ìˆìœ¼ë©´ ë‹«ê¸°
    if in_list:
        html_lines.append("</ul>")

    return "\n".join(html_lines)


def build_html(results: list[dict]) -> str:
    today = date.today().strftime("%Yë…„ %mì›” %dì¼")

    items_html = ""
    for r in results:
        summary_html = markdown_to_html(r["summary"])
        items_html += f"""
        <div style="
            margin-bottom: 40px;
            padding: 24px;
            background: #fafafa;
            border-left: 4px solid #ff0000;
            border-radius: 4px;
        ">
            <h3 style="margin: 0 0 6px; font-size: 18px;">
                <a href="{r['link']}" style="color: #222; text-decoration: none;">
                    {r['title']}
                </a>
            </h3>
            <p style="margin: 0 0 16px; color: #888; font-size: 13px;">
                ğŸ“º {r['channel']}
            </p>
            <div style="font-size: 14px; color: #333;">
                {summary_html}
            </div>
        </div>
        """

    return f"""
    <html>
    <body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                 max-width: 700px; margin: auto; padding: 24px; color: #222;">
        <h2 style="border-bottom: 2px solid #ff0000; padding-bottom: 12px;">
            ğŸ“¬ ì˜¤ëŠ˜ì˜ ìœ íŠœë¸Œ ìš”ì•½ â€” {today}
        </h2>
        <p style="color: #666; font-size: 13px; margin-bottom: 32px;">
            ì´ {len(results)}ê°œ ì˜ìƒì˜ í•µì‹¬ ë‚´ìš©ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.
        </p>
        {items_html}
        <hr style="border: none; border-top: 1px solid #eee; margin-top: 40px;">
        <p style="font-size: 11px; color: #aaa; text-align: center;">ìë™ ë°œì†¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.</p>
    </body>
    </html>
    """


async def send_email(results: list[dict]):
    html_content = build_html(results)

    msg = MIMEMultipart("alternative")
    msg["Subject"] = f"ğŸ“¬ ìœ íŠœë¸Œ ìš”ì•½ {date.today().strftime('%m/%d')} ({len(results)}ê°œ)"
    msg["From"] = GMAIL_USER
    msg["To"] = RECIPIENT_EMAIL
    msg.attach(MIMEText(html_content, "html", "utf-8"))

    with smtplib.SMTP_SSL("smtp.gmail.com", 465) as server:
        server.login(GMAIL_USER, GMAIL_APP_PASSWORD)
        server.sendmail(GMAIL_USER, RECIPIENT_EMAIL, msg.as_string())

    print(f"  â†’ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ (ìˆ˜ì‹ : {RECIPIENT_EMAIL})")
```

> ğŸ’¡ **`MIMEMultipart("alternative")`ê°€ ë­”ê°€ìš”?**  
> ì´ë©”ì¼ì€ í‰ë¬¸(plain text)ê³¼ HTML ë‘ ê°€ì§€ ë²„ì „ì„ ê°™ì´ ë‹´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `"alternative"`ëŠ” "HTMLì„ ì§€ì›í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” HTMLë¡œ, ì•„ë‹ˆë©´ plain textë¡œ ë³´ì—¬ë¼"ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” HTMLë§Œ ì²¨ë¶€í•˜ì§€ë§Œ, ë‚˜ì¤‘ì— plain text ë²„ì „ë„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ **SMTP_SSL í¬íŠ¸ 465 vs STARTTLS í¬íŠ¸ 587 ì°¨ì´ëŠ”?**  
> í¬íŠ¸ 465(`SMTP_SSL`)ëŠ” ì²˜ìŒ ì—°ê²°ë¶€í„° TLS ì•”í˜¸í™”ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. í¬íŠ¸ 587(`SMTP` + `starttls()`)ì€ ì¼ë°˜ ì—°ê²°ë¡œ ì‹œì‘í•´ì„œ ì¤‘ê°„ì— ì•”í˜¸í™”ë¡œ ì—…ê·¸ë ˆì´ë“œí•©ë‹ˆë‹¤. Gmailì€ ë‘˜ ë‹¤ ì§€ì›í•˜ì§€ë§Œ, 465ê°€ ë” ë‹¨ìˆœí•˜ê³  ì§ê´€ì ì…ë‹ˆë‹¤.

---

### 4-9. Dockerfile

ì„œë²„ ì„¤ì • ê°€ì´ë“œì—ì„œ ì‘ì„±í•œ `Dockerfile`ì—ì„œ ë³€ê²½í•  ê²ƒì€ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```dockerfile
FROM python:3.12-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app/ ./app/

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

### 4-10. docker-compose.yml

ì„œë²„ ì„¤ì • ê°€ì´ë“œì˜ `docker-compose.yml`ì—ì„œ ë³€ê²½í•  ê²ƒì€ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```yaml
services:
  app:
    build: .
    container_name: youtube-summary
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - TZ=Asia/Seoul
    env_file:
      - .env
```

> ğŸ’¡ **`TZ=Asia/Seoul`ì´ ì™œ í•„ìš”í•œê°€ìš”?**  
> Docker ì»¨í…Œì´ë„ˆëŠ” ê¸°ë³¸ì ìœ¼ë¡œ UTC íƒ€ì„ì¡´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. `TZ=Asia/Seoul`ì„ ì„¤ì •í•˜ë©´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì‹œìŠ¤í…œ ì‹œê°„ì´ KST(UTC+9)ë¡œ ë§ì¶°ì§‘ë‹ˆë‹¤. APSchedulerì˜ `CronTrigger(hour=7)`ì´ í•œêµ­ ì‹œê°„ ì˜¤ì „ 7ì‹œë¡œ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.

---

## 5. ë°°í¬ ë° í…ŒìŠ¤íŠ¸

### 5-1. íŒŒì¼ ì‘ì„±

GCP ì„œë²„ì— SSHë¡œ ì ‘ì†í•œ í›„, ê° íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.

```bash
# ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
mkdir -p ~/youtube-summary/app
cd ~/youtube-summary

# ê° íŒŒì¼ ìƒì„±
nano requirements.txt      # 4-1 ë‚´ìš© ì…ë ¥
nano .env                  # 4-2 ë‚´ìš© ì…ë ¥ í›„ API í‚¤ ì±„ìš°ê¸°
nano app/main.py           # 4-3 ë‚´ìš© ì…ë ¥
nano app/scheduler.py      # 4-4 ë‚´ìš© ì…ë ¥
nano app/youtube.py        # 4-5 ë‚´ìš© ì…ë ¥
nano app/transcript.py     # 4-6 ë‚´ìš© ì…ë ¥
nano app/summarize.py      # 4-7 ë‚´ìš© ì…ë ¥
nano app/mailer.py         # 4-8 ë‚´ìš© ì…ë ¥
```

> ğŸ’¡ **`nano` ì‚¬ìš©ë²•:**  
> ë‚´ìš© ì…ë ¥ í›„ `Ctrl+O` â†’ `Enter`(ì €ì¥), `Ctrl+X`(ì¢…ë£Œ)

### 5-2. ì»¨í…Œì´ë„ˆ ë¹Œë“œ ë° ì‹¤í–‰

```bash
cd ~/youtube-summary
docker compose up -d --build
```

### 5-3. í—¬ìŠ¤ ì²´í¬

```bash
curl http://localhost:8000/health
# ê¸°ëŒ€ ì‘ë‹µ: {"status":"ok"}
```

### 5-4. ì¦‰ì‹œ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ (í•µì‹¬!)

ìŠ¤ì¼€ì¤„ ì‹œê°„ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  íŒŒì´í”„ë¼ì¸ ì „ì²´ë¥¼ ì¦‰ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
curl -X POST http://localhost:8000/run-now
```

ì‹¤í–‰ ê²°ê³¼ëŠ” ë¡œê·¸ì—ì„œ í™•ì¸í•©ë‹ˆë‹¤.

```bash
docker compose logs -f app
```

ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ê°€ í˜ëŸ¬ê°€ë©´ ì •ìƒì…ë‹ˆë‹¤.

```
âœ… APScheduler ì‹œì‘ë¨. ë§¤ì¼ 07:00 KSTì— ì‹¤í–‰ë©ë‹ˆë‹¤.
========================================
ğŸ“º ìœ íŠœë¸Œ ìš”ì•½ íŒŒì´í”„ë¼ì¸ ì‹œì‘
========================================

ğŸ“¡ ì±„ë„ ì²˜ë¦¬ ì¤‘: UCxxx...
  â†’ ì‹ ê·œ ì˜ìƒ 2ê°œ ë°œê²¬

  ğŸ¬ ì²˜ë¦¬: ì˜ìƒ ì œëª© ì˜ˆì‹œ
     â†’ ìë§‰ 4521ì ìˆ˜ì§‘ ì™„ë£Œ
     â†’ ìš”ì•½ ì™„ë£Œ
...
ğŸ“§ ì´ 3ê°œ ì˜ìƒ ìš”ì•½ ì™„ë£Œ
âœ… ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ
```

### 5-5. ì´ë©”ì¼ ìˆ˜ì‹  í™•ì¸

ì§€ì •í•œ `RECIPIENT_EMAIL`ë¡œ ì´ë©”ì¼ì´ ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ìŠ¤íŒ¸í•¨ë„ í™•ì¸í•´ë³´ì„¸ìš”.

---

## 6. ìì£¼ ì“°ëŠ” ê´€ë¦¬ ëª…ë ¹ì–´

```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker compose ps

# ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸°
docker compose logs -f app

# ì½”ë“œ ìˆ˜ì • í›„ ì¬ë¹Œë“œ & ì¬ì‹œì‘
docker compose up -d --build

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (ì½”ë“œ ë³€ê²½ ì—†ì´)
docker compose restart app

# ì¦‰ì‹œ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸)
curl -X POST http://localhost:8000/run-now

# ì„œë²„ ë©”ëª¨ë¦¬ ìƒíƒœ
free -h

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
df -h
```

---

## 7. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¹Œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë‚  ë•Œ

```bash
docker compose logs app
```

ë¡œê·¸ì—ì„œ ì–´ë–¤ íŒ¨í‚¤ì§€ ì„¤ì¹˜ê°€ ì‹¤íŒ¨í–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ë¶€ì¡±ì´ë¼ë©´ `free -h`ë¡œ swap ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.

### YouTube APIì—ì„œ `quotaExceeded` ì˜¤ë¥˜

í•˜ë£¨ 10,000 units í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. UTC ê¸°ì¤€ ìì •ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ì±„ë„ ìˆ˜ë¥¼ ì¤„ì´ê±°ë‚˜ `maxResults`ë¥¼ ë‚®ì¶”ëŠ” ê²ƒìœ¼ë¡œ ì†Œëª¨ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Gemini APIì—ì„œ `429 Too Many Requests` ì˜¤ë¥˜

ë¬´ë£Œ í”Œëœ ê¸°ì¤€ ë¶„ë‹¹ 15 ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì±„ë„ ìˆ˜ê°€ ë§ê±°ë‚˜ ì˜ìƒì´ ëª°ë ¤ìˆì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤. `summarize.py`ì˜ `async with httpx.AsyncClient()` í˜¸ì¶œ ì „ì— `await asyncio.sleep(4)`ë¥¼ ì¶”ê°€í•´ ìš”ì²­ ê°„ê²©ì„ ì¡°ì ˆí•©ë‹ˆë‹¤.

```python
import asyncio

async def summarize(transcript: str, title: str) -> str:
    await asyncio.sleep(4)  # ìš”ì²­ ê°„ê²© 4ì´ˆ í™•ë³´
    ...
```

### ì´ë©”ì¼ì´ ì•ˆ ì˜¬ ë•Œ

1. Gmail 2ë‹¨ê³„ ì¸ì¦ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
2. ì•± ë¹„ë°€ë²ˆí˜¸ì— ê³µë°±ì´ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. (16ìë¦¬, ê³µë°± ì—†ìŒ)
3. `.env`ì˜ `GMAIL_USER`ì™€ `GMAIL_APP_PASSWORD`ê°€ ì •í™•í•œì§€ í™•ì¸í•©ë‹ˆë‹¤.
4. Gmail ìŠ¤íŒ¸í•¨ì„ í™•ì¸í•©ë‹ˆë‹¤.
5. `docker compose logs app`ì—ì„œ SMTP ê´€ë ¨ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

### ìë§‰ì´ í•­ìƒ Noneìœ¼ë¡œ ë°˜í™˜ë  ë•Œ

1. í•´ë‹¹ ì˜ìƒì— ìë§‰ì´ ìˆëŠ”ì§€ YouTubeì—ì„œ ì§ì ‘ í™•ì¸í•©ë‹ˆë‹¤. (ìë§‰ ë²„íŠ¼ í´ë¦­)
2. í•œêµ­ì–´ ìë§‰ì´ ì—†ëŠ” ì˜ìƒì€ `lang` íŒŒë¼ë¯¸í„°ë¥¼ `en`ìœ¼ë¡œ ë°”ê¿”ë³´ê±°ë‚˜ ì•„ì˜ˆ ì œê±°í•´ë´…ë‹ˆë‹¤.
3. Supadata API í‚¤ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ë¬´ë£Œ í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì»¨í…Œì´ë„ˆê°€ `run-now` ì§í›„ ì£½ì„ ë•Œ

ë©”ëª¨ë¦¬ ë¶€ì¡±(OOM)ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. `free -h`ë¡œ swap ì„¤ì •ì„ í™•ì¸í•˜ê³ , ê°€ì´ë“œì˜ 4-2 Swap ì„¤ì • ë‹¨ê³„ë¥¼ ë‹¤ì‹œ ì§„í–‰í•©ë‹ˆë‹¤.

---

## ìµœì¢… ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸

```
~/youtube-summary/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env                  â† Gitì— ì ˆëŒ€ ì˜¬ë¦¬ì§€ ì•Šê¸°
â””â”€â”€ app/
    â”œâ”€â”€ main.py
    â”œâ”€â”€ scheduler.py
    â”œâ”€â”€ youtube.py
    â”œâ”€â”€ transcript.py
    â”œâ”€â”€ summarize.py
    â””â”€â”€ mailer.py
```

---

*ë‹¤ìŒ ë‹¨ê³„: ì •ìƒ ë™ì‘ í™•ì¸ í›„ ì±„ë„ ëª©ë¡ í™•ì¥ ë° ìš”ì•½ í”„ë¡¬í”„íŠ¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•*
