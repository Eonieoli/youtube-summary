import os
from google import genai

client = genai.Client(api_key=os.getenv("GEMINI_API_KEY"))

PROMPT_TEMPLATE = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ì˜ìƒì„ ë¶„ì„í•´ ë…ìžì—ê²Œ ì˜ìƒì˜ ëª¨ë“  í•µì‹¬ì„ ì „ë‹¬í•˜ëŠ” ì „ë¬¸ ì—ë””í„°ìž…ë‹ˆë‹¤.
ì•„ëž˜ëŠ” ì˜ìƒ "{title}"ì˜ ìžë§‰ ì „ë¬¸ìž…ë‹ˆë‹¤.

ì´ ì˜ìƒì„ ë³´ì§€ ì•Šì€ ì‚¬ëžŒë„ ë‚´ìš©ì„ ì™„ì „ížˆ ì´í•´í•  ìˆ˜ ìžˆë„ë¡ ì•„ëž˜ í˜•ì‹ìœ¼ë¡œ ìž‘ì„±í•´ì£¼ì„¸ìš”.

## ðŸ“Œ í•œ ì¤„ ìš”ì•½
ì˜ìƒ ì „ì²´ë¥¼ í•œ ë¬¸ìž¥ìœ¼ë¡œ ì••ì¶•í•´ì£¼ì„¸ìš”.

## ðŸ—‚ ë°°ê²½ ë° ë§¥ë½
ì´ ì˜ìƒì´ ë‹¤ë£¨ëŠ” ì£¼ì œì˜ ë°°ê²½, ì‚¬íšŒì /ê²½ì œì  ë§¥ë½, ì™œ ì§€ê¸ˆ ì´ ì£¼ì œê°€ ì¤‘ìš”í•œì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”. (3~5ë¬¸ìž¥)

## ðŸ” í•µì‹¬ ë‚´ìš©
ì˜ìƒì—ì„œ ë‹¤ë£¨ëŠ” í•µì‹¬ ë…¼ì , ì£¼ìž¥, ë°ì´í„°, ì‚¬ë¡€ë¥¼ ë¹ ì§ì—†ì´ ì •ë¦¬í•´ì£¼ì„¸ìš”.
ê° í•­ëª©ì€ ì†Œì œëª©ê³¼ í•¨ê»˜ êµ¬ì²´ì ìœ¼ë¡œ ìž‘ì„±í•´ì£¼ì„¸ìš”. (ìµœì†Œ 5ê°œ í•­ëª©)

## ðŸ’¡ ì¸ì‚¬ì´íŠ¸ ë° ì‹œì‚¬ì 
ì´ ì˜ìƒì´ ì „ë‹¬í•˜ë ¤ëŠ” ë©”ì‹œì§€, ì‹œì²­ìžê°€ ì–»ì–´ê°ˆ ìˆ˜ ìžˆëŠ” êµí›ˆì´ë‚˜ ê´€ì ì„ ì •ë¦¬í•´ì£¼ì„¸ìš”. (3~5ë¬¸ìž¥)

---
{transcript}
"""


async def summarize(transcript: str, title: str) -> str:
    truncated_transcript = transcript[:20000]

    prompt = PROMPT_TEMPLATE.format(
        title=title,
        transcript=truncated_transcript,
    )

    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=prompt,
    )

    return response.text